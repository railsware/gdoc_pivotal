((function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=typeof global!="undefined"&&global!==null?global:window,a.GDocumentApi=function(){function a(a){this.params=a!=null?a:{},this.handleUploadSuccess=b(this.handleUploadSuccess,this),this.handleUploadDocument=b(this.handleUploadDocument,this),this.uploadDocument=b(this.uploadDocument,this),this.handleDocument=b(this.handleDocument,this),this.createDocument=b(this.createDocument,this),this.setTitle=b(this.setTitle,this),this.setBody=b(this.setBody,this),this.authorizeOAuth=b(this.authorizeOAuth,this);if(this.params.oauth==null){if(!("function"==typeof ChromeExOAuth&&this.params.OAuthAppName&&this.params.consumerKey&&this.params.consumerSecret))return null;this.params.oauth=ChromeExOAuth.initBackgroundPage({request_url:"https://www.google.com/accounts/OAuthGetRequestToken",authorize_url:"https://www.google.com/accounts/OAuthAuthorizeToken",access_url:"https://www.google.com/accounts/OAuthGetAccessToken",consumer_key:this.params.consumerKey,consumer_secret:this.params.consumerSecret,scope:this.DOCLIST_SCOPE,app_name:this.params.OAuthAppName})}}return a.prototype.DOCLIST_SCOPE="https://docs.google.com/feeds",a.prototype.RESUMABLE_CHUNK=262144,a.prototype.docLength=0,a.prototype.docUrl=null,a.prototype.authorizeOAuth=function(a){return a==null&&(a=null),this.params.oauth.authorize(function(){if(a!=null&&"function"==typeof a)return a()})},a.prototype.setBody=function(a){return this.params.body=a},a.prototype.setTitle=function(a){return this.params.title=a},a.prototype.createDocument=function(){var a,b;return a={method:"POST",headers:{"GData-Version":"3.0","Content-Type":"text/html",Slug:this.params.title,"X-Upload-Content-Type":"text/html","X-Upload-Content-Length":this.params.body.length},parameters:{alt:"json"}},b=""+this.DOCLIST_SCOPE+"/upload/create-session/default/private/full",this.params.oauth.sendSignedRequest(b,this.handleDocument,a)},a.prototype.updateDocument=function(a){var b,c;return b={method:"PUT",headers:{"GData-Version":"3.0","Content-Type":"text/html","If-Match":"*",Slug:this.params.slug||"GDoc Patch","X-Upload-Content-Type":"text/html","X-Upload-Content-Length":this.params.body.length},parameters:{alt:"json"}},c=""+this.DOCLIST_SCOPE+"/upload/create-session/default/private/full/"+a,this.params.oauth.sendSignedRequest(c,this.handleDocument,b)},a.prototype.handleDocument=function(a,b){if(4===b.readyState&&200===b.status){if(b.getResponseHeader("location"))return this.docLength=0,this.docUrl=b.getResponseHeader("location"),this.uploadDocument();if(this.params.error!=null&&"function"==typeof this.params.error)return this.params.error(a,b)}else if(this.params.error!=null&&"function"==typeof this.params.error)return this.params.error(a,b)},a.prototype.uploadDocument=function(){var a,b,c;return a=this.docLength,c=this.docLength+this.RESUMABLE_CHUNK,c>this.params.body.length&&(c=this.params.body.length),this.docLength=c,b={method:"PUT",headers:{"GData-Version":"3.0","Content-Type":"text/html","Content-Range":"bytes  "+a+"-"+(c-1)+"/"+this.body.length},parameters:{alt:"json"},body:this.params.body.substring(a,c)},GdocPivotalBackground.oauth.sendSignedRequest(this.docUrl,this.handleUploadDocument,b)},a.prototype.handleUploadDocument=function(a,b){if(308===b.status&&4===b.readyState)return this.docLength<this.params.body.length?(b.getResponseHeader("location")&&(this.docUrl=b.getResponseHeader("location")),this.uploadDocument()):this.handleUploadSuccess(a,b);if(200===b.status||201===b.status||400===b.status)return this.handleUploadSuccess(a,b);if(this.params.error!=null&&"function"==typeof this.params.error)return this.params.error(a,b)},a.prototype.handleUploadSuccess=function(a,b){if(this.params.success!=null&&"function"==typeof this.params.success)return this.params.success(a,b)},a}()})).call(this);
