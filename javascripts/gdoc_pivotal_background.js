((function(){var a;a=typeof global!="undefined"&&global!==null?global:window,a.GdocPivotalBackground={DOCLIST_SCOPE:"https://docs.google.com/feeds",DOCLIST_FEED:"https://docs.google.com/feeds/default/private/full/",oauth:null,pivotal_regex:/https:\/\/www.pivotaltracker.com\/story\/show\/([\d]+)/i,RESUMABLE_CHUNK:262144,resumable_url:null,resumable_length:0,init:function(){return GdocPivotalBackground.oauth=ChromeExOAuth.initBackgroundPage({request_url:"https://www.google.com/accounts/OAuthGetRequestToken",authorize_url:"https://www.google.com/accounts/OAuthAuthorizeToken",access_url:"https://www.google.com/accounts/OAuthGetAccessToken",consumer_key:"125112163426-r1iv64gdhf9t4g23u8kh802io978ftnr.apps.googleusercontent.com",consumer_secret:"JU87RE7mHOi18mbhM3tUJCud",scope:GdocPivotalBackground.DOCLIST_SCOPE,app_name:"GDoc Pivotal"})},create_resumable_gdocument:function(){var a,b;return a={method:"POST",headers:{"GData-Version":"3.0","Content-Type":"text/html",Slug:"gdoc_pivotal_"+(new Date).getTime(),"X-Upload-Content-Type":"text/html","X-Upload-Content-Length":GdocPivotalBackground.gdoc.length},parameters:{alt:"json"}},b=""+GdocPivotalBackground.DOCLIST_SCOPE+"/upload/create-session/default/private/full",GdocPivotalBackground.oauth.sendSignedRequest(b,GdocPivotalBackground.handle_resumable_gdocument,a)},update_resumable_gdocument:function(){var a,b;return a={method:"PUT",headers:{"GData-Version":"3.0","Content-Type":"text/html","If-Match":"*",Slug:"GDoc Pivotal Patch","X-Upload-Content-Type":"text/html"},"X-Upload-Content-Length":GdocPivotalBackground.gdoc.length},{parameters:{alt:"json"}},b=""+DOCLIST_SCOPE+"/upload/create-session/default/private/full/"+GdocPivotalBackground.doc_key,GdocPivotalBackground.oauth.sendSignedRequest(b,GdocPivotalBackground.handle_resumable_gdocument,a)},handle_resumable_gdocument:function(a,b){return 4===b.readyState&&200===b.status?b.getResponseHeader("location")?(GdocPivotalBackground.resumable_url=b.getResponseHeader("location"),GdocPivotalBackground.upload_resumable_document()):GdocPivotalBackground.clear_variables():(GdocPivotalBackground.show_error_message_on_popup("Error creating document. Sorry :("),GdocPivotalBackground.clear_variables())},upload_resumable_document:function(){var a,b;return a=GdocPivotalBackground.resumable_length,b=GdocPivotalBackground.resumable_length+GdocPivotalBackground.RESUMABLE_CHUNK,b>GdocPivotalBackground.gdoc.length&&(b=GdocPivotalBackground.gdoc.length),GdocPivotalBackground.resumable_length=b,$.ajax({type:"PUT",url:GdocPivotalBackground.resumable_url,data:GdocPivotalBackground.gdoc.substring(a,b),contentType:"text/html",headers:{"GData-Version":"3.0","Content-Type":"text/html","Content-Range":"bytes  "+a+"-"+(b-1)+"/"+GdocPivotalBackground.gdoc.length},complete:function(a,b){return GdocPivotalBackground.handle_upload_resumable_document(a.responseText,a)}})},handle_upload_resumable_document:function(a,b){return 308===b.status&&4===b.readyState?GdocPivotalBackground.resumable_length<GdocPivotalBackground.gdoc.length?(b.getResponseHeader("location")&&(GdocPivotalBackground.resumable_url=b.getResponseHeader("location")),GdocPivotalBackground.upload_resumable_document()):GdocPivotalBackground.handle_upload_success(a,b):200===b.status||201===b.status||400===b.status?GdocPivotalBackground.handle_upload_success(a,b):GdocPivotalBackground.clear_variables()},handle_upload_success:function(a,b){var c;return c=JSON.parse(a)},clear_variables:function(){return GdocPivotalBackground.doc_key=null,GdocPivotalBackground.gdoc=null},set_icon_text:function(a){return chrome.browserAction.setBadgeText({text:a})},logout:function(){return GdocPivotalBackground.set_icon_text(""),GdocPivotalBackground.oauth.clearTokens()}},$(function(){return GdocPivotalBackground.init()})})).call(this);
